---
  - name: Initial setup
    hosts: all
    roles:
      - init
    tags: init
  - name: DNS server setup
    hosts: dns_servers
    roles:
      - bind
    tags: d
  - name: resolv.conf configuration
    hosts: all
    tasks:
      - name: systemd-resolved service is stopped
        service:
          name: systemd-resolved
          state: stopped
          enabled: true
      - name: Copy file resolv.conf.j2
        template:
          src: resolv.conf.j2
          dest: /etc/resolv.conf
    tags: resolv
  - name: Mysql setup
    hosts: db_servers
    roles: 
      - mysql
    tags: m
  - name: Web server setup
    hosts: web_servers
    roles:
      - agama
      - uwsgi
      - nginx
    tags: n
  - name: Prometheus setup
    hosts: monitoring
    roles:
      - prometheus
    tags: p
  - name: Grafana setup
    hosts: grafana
    roles:
      - grafana
    tags: g
  - name: Pinger setup
    hosts: influxdb
    roles:
      - pinger
    tags: pinger
  - name: Influxdb setup
    hosts: influxdb
    roles:
      - influxdb
    tags: i
